<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paic.pluto.dao.ImageAgreeDao">
	
	
	
	
	<select id="queryAgree" resultType="com.paic.pluto.pojo.ImageAgree">
		 select a.dbid 
		 from pluto_img_agree a  
		 where a.agree_open_id = #{0} and a.img_id = #{1} 
		 limit 1
	</select>
	
	
	<insert id="insertAgree"  useGeneratedKeys="true" keyProperty="dbid" parameterType="com.paic.pluto.pojo.ImageAgree">
		insert into pluto_img_agree(agree_open_id,img_id) values(#{openId},#{imgId})
	</insert>
	
	<delete id="deleteAgree">
		delete from pluto_img_agree where agree_open_id = #{0} and img_id = #{1}
	</delete>
	
	<select id="getTheTop10" resultType="java.lang.String">
		select c.show_name
		from pluto_img_upload a ,pluto_user_info c,pluto_img_base b
		LEFT JOIN  (select img_id,count(1) num from  pluto_img_agree  group by img_id) d on b.dbid = d.img_id
		where a.dbid=b.upload_id
		 and  b.open_id = c.open_id
		 and  a.is_delete ='N'
   		group by  c.open_id,c.show_name
		order by max(num)  desc
		 limit #{0}
	</select>
	
</mapper>