//加载完毕调用
$(function() {
	init();
});
//初始化基础方法
function init() {
	initClick();
}
//获取问卷信息
function initClick() {
	getComment();
};
// 获取问卷信息
function getComment() {
	getMsg();
}
//回退
function commBack(){

	$('body').popup({
		title : '确定放弃本次问卷答题吗',
		id : 'pop-1',
		formId : 'form-1',
		closeOnOk :false,
		onCancel : function() {
			$("#pop-1").trigger("close");
		},
		ok : '确认',
		position:'center',
		onOk : function() {
			window.location.href="../../h5/answer/conference.html";
		}
	});
	
}
//几颗星的评价
function starChose(a){
	for(var i=1;i<=5;i++){
		$('#star'+i).removeClass("starOn");
		$('#star'+i).addClass("star");
	}
	for(var i=1;i<=a;i++){
		$('#star'+i).addClass("starOn");
	}
	$('#star'+a+'').attr("checked","checked");
	$('#commentValue').attr("value",a);
}
//印象选择
function comQa(e){
	var attr=$('#'+e).attr('class');
	if(attr == null || attr =="" || attr == undefined){
		$('#'+e).addClass('evaluteMarkOn');
	}else{
		$('#'+e).removeClass('evaluteMarkOn');
	}
}
//获取个人评价
function getMsg() {
	var  investigationID =sessionStorage.getItem('investigationID');
	$.ajax({
		type : 'POST',
		url : "/pawj/app/answer/theHottestComments.do",
		data : {
			'qsrId' : investigationID
		},
		dataType : "JSON",
		success : function(data) {
			if(!Validator.validateNull(data)){
				var dt=$.parseJSON(data);
				var com="";
				var obj= dt.comments;
				$.each(obj,function(i,item){
					com+='<li id="'+item.commentID+'" value="'+item.comment+'" onclick="comQa(\''+item.commentID+'\')">'+item.comment+'</li>';
				});
				$('#comQa').append(com);
			}else{
				$.popAlert("获取奖励金额和积分失败!");
			}
		}
	});
}
//提交
function sub(){
	var datalist = {};
	var commentlist = [];
	var com=[];
	var  investigationID =sessionStorage.getItem('investigationID');//问卷ID
	var comScore=$('#commentValue').val();//评分
	var comment=$('#placeholder').val();//输入框  评价
	var liValue=$('#comQa').find('li');//热门评论
	if (Validator.validateNull(comScore)) {
		$.popAlert("暂未评星");
		return;
	}
	if (Validator.validateNull(comment)) {
		$.popAlert("请输入您的印象");
		return;
	}
	if (comment.length>20) {
		$.popAlert("印象20字以内");
		return;
	}
	var commFalg= false;
	$('.evaluteMarkOn').each(function(index,item){
		var comId = item.id; 
		commFalg = true;
		commentlist.push({"commentID":comId,"comment":comment});
	});
	if(!commFalg){
		$.popAlert("请选择您对本问卷的印象");
		return;
	}
	datalist={
			"qsrId": investigationID,
			"score": comScore,
			"comments": commentlist
		};
	var obj ={};
	obj.data=datalist;
	$.ajax({
		type : 'POST',
		url : "/pawj/app/answer/investigationComments.do",
		data: JSON.stringify(obj),
		dataType:'json',
		contentType:"application/json",
		success : function(data) { 
			if(data.retCode=="0000"){
				window.location.href = "../../h5/answer/reward.html";
				}else{
					$.popAlert("评价失败!");
				}
		}
	});
}