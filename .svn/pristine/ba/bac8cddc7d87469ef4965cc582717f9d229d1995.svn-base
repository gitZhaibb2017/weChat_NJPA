var myScroll;//iscroll初始化
var	downIcon,distance;//下拉刷新图标,拉动距离
//加载完毕调用
$(function() {
	init();
});
//初始化基础方法
function init() {
	distance =30;//刷新滑动距离
	var click = phoneVersion();
	myScroll = new IScroll('#scroll_container', {
		probeType : 3,
		mouseWheel : true,
		click:click
	});
	initClick();
	//初始化下拉列表操作
	var scrollHeight = $('body').height()-65;
	$('#scroll_container').height(scrollHeight);
	$('#main_container').css('min-height',scrollHeight+1);
	myScroll.refresh();
}

//获取问卷信息
function initClick() {
//	FastClick.attach(document.body);
	getConference();
// 下拉刷新事件
	myScroll.on("slideDown",function(){
		if(this.y > distance){
			//刷新页面
			window.location.reload();
		}
	});
// 上拉滑动事件
	myScroll.on("slideUp",function(){
		if(this.maxScrollY - this.y > distance){
//			refreshtaskList();
			myScroll.refresh();
		}
	});
};
// 获取问卷信息
function getConference() {
	getMsg();
	getMsgToMe();
}
//回退
function confereBack(){
	window.history.back();
}
function getMsg() {
	$.ajax({
		type : 'POST',
		url : "/pawj/app/investigation/newInvestigations.do",
		dataType : "JSON",
		success : function(data) {
			if(!Validator.validateNull(data)){
				var dt=$.parseJSON(data).investigations;
				var h = "";
				$.each(dt,function(i,item){
					var fee = item.answerFee;
					if (!fee) {
						fee = "+" + 0;
					} else {
						fee = "+" + fee;
					}
					h += '<li id="name">'+
					'<a href="QA.html?investigationID='+item.investigationId+'">'+item.investigationName
					+'</a><span><label style="width: '+item.completionRate+';"></label></span><b>'
					+fee+'</b></li>';
					//sessionStorage.setItem('investigationID',item.investigationId);
				});
				$("#name").after(h);
			}else{
				$.popAlert("查询全部问卷失败");
			}
		}
	});
}
function getMsgToMe() {
	$.ajax({
		type : 'POST',
		url : "/pawj/getInvestigation.do",
		dataType : "JSON",
		success : function(data) {
			if(!Validator.validateNull(data)){
				
				var dt=$.parseJSON(data).businvestiList;
				var h = "";
				$.each(dt,function(i,item){
					var fee = item.answerFee;
					if (!fee) {
						fee = "+" + 0;
					} else {
						fee = "+" + fee;
					}
					h += '<li id="myQues">'+
					'<a href="QA.html?investigationID='+item.investigationId+'">'+item.name
					+'</a><span><label style="width: '+item.qsrComPer+';"></label></span><b>'
					+fee+'</b></li>';
					//sessionStorage.setItem('investigationID',item.investigationId);
				});
				$("#myQues").after(h);
			}else{
				$.popAlert("查询适合我的失败");
			}
		}
	});
}


function phoneVersion() {
	var Terminal = {
		// 辨别移动终端类型
		platform : function() {
			var u = navigator.userAgent, app = navigator.appVersion;
			return {
				// android终端或者uc浏览器
				android : u.indexOf('Android') > -1 || u.indexOf('Linux') > -1,
				// 是否为iPhone或者QQHD浏览器
				iPhone : u.indexOf('iPhone') > -1,
				// 是否iPad
				iPad : u.indexOf('iPad') > -1
			};
		}(),
		// 辨别移动终端的语言：zh-cn、en-us、ko-kr、ja-jp...
		language : (navigator.browserLanguage || navigator.language)
				.toLowerCase()
	}
	
	if (Terminal.platform.android) {
		return true;
	} else if (Terminal.platform.iPhone) {
		return true;
	} else{
		return false;
	}
}