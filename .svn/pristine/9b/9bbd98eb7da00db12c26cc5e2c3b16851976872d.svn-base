var curIndex;// 当前图片
var timeStep;// 时间间隔 单位毫秒
var hotContent = [];
var report;
var simpleQsr = 0;
var contentCount = 5;
function onError(){
	$("#avatar").attr("src","../../images/icon_not_login.png");
}
$(function() {
	initIndex();
});
// 初始化基础方法
function initIndex() {
	$("#sign").on("click", function sign() {
		$("#heart").remove();
		$("#isSign").replaceWith('已签到');
		$("#sign").unbind("click");
		executeSign();
	});
	// 获取热门问卷
	getHotContent();
	// 获取个人积分 金额 头像
	getUserInfo();
	// 获取是否签到
	getCheckInStatus();
	// 获取趣味报告
	getInterestContent();
	// 定时切换图片
	$("#show").on("click", function() {
		simpleQsr++;
	});
	// 选中图片的效果
	$("#swipe-wrap").find("li").on("click", function() {
		$.popAlert("link to 广告");
	});
	$(document).ready(function() {
		$("#avatar").on("load", function() {
			var w = $(this).height();
			var padding = $(".top").css("padding-top");
			var padValue = padding.substring(0, padding.indexOf("p"));
			$(".banner").css("margin-top", w + padValue * 2 + "px");
		});
	});
}
// 获取是否签到
function getCheckInStatus() {
	$.ajax({
		type : 'GET',
		url : "/pawj/getCheckInStatus.do",
		dataType : "JSON",
		success : function(e) {
			var data = $.parseJSON(e);
			if (data.retCode == '1000'){
				$.popAlert("获取签到信息失败");
			}else{
			var isSign = data.checkInStatus;
			if (isSign == '1') {
				$("#isSign").append('已签到');
				$("#sign").unbind("click");
			} else {
				var heart = '<img src="../../images/icon_heart.png" />';
				$("#heart").append(heart);
				$("#isSign").append('签到');
			}}
		}
	});
}
// 签到调用后台接口
function executeSign() {
	$.ajax({
		type : 'POST',
		url : '/pawj/updateCheckInStatus.do',
		dataType : 'JSON',
		success : function(e) {
			var data = $.parseJSON(e);
			if(data.retCode == '1000'){
				$.popAlert(data.errorMsg);
			}else{
				getUserInfo();
				}
			
		}
	});
}
// 获取个人信息
function getUserInfo() {
	$.ajax({
		type : 'POST',
		url : "/pawj/app/person/queryUserInfo.do",
		dataType : "JSON",
		success : function(dat) {
			var data = $.parseJSON(dat);
			var balance = data.balance;// 余额
			var score = data.score;// 积分
			var gradeName = data.gradeName;// 等级名称
			var level = data.level;// 财富
			var picturePath = data.picturePath;// 头像路径
			if (level == null || level == 'undefined') {
				level = 0;
			}
			if (balance == null || balance == 'undefined') {
				balance = 0;
			}
			if (score == null || score == 'undefined') {
				score = 0;
			}
			if (gradeName == null || gradeName == 'undefined') {
				gradeName = "Lv1";
			}
			if (picturePath == null || picturePath == 'undefined') {
				picturePath = '../../images/icon_not_login.png';
			}
			$("#score").html(score);
			$("#balance").html(balance);
			$("#gradeName").html(gradeName);
//			$("#avatar").attr('src', '../../images/icon_avatar.png');
			$("#avatar").attr('src',picturePath);
		}
	});

}
// 获取热门问卷
function getHotContent() {
	$.ajax({
		type : 'GET',
		url : '/pawj/getHpTopical.do',
		dataType : 'JSON',
		success : function(e) {
			var data = $.parseJSON(e);
			if (data.retCode == "1000") {
				$.popAlert("登录已失效，请重新登录！");
				setTimeout(function() {
					window.location.href = "../login/loginPAWJ.html";
				}, 3000);
	
			} else {
				report = data.report;
				for (var i = 0; i < report.length; i++) {
					hotContent[i] = report[i];
				}
				for (i = 0; i < hotContent.length; i++) {
					$("#hot_content")
							.append(
									'<li index='
											+ i
											+ ' id="hotContent'
											+ i
											+ '"><a>'
											+ hotContent[i].qsrName
											+ '</a><span><label style="width: '
											+ hotContent[i].qsrComPer
											+ '%;"></label></span><b>99999.99</b></li>');
					$("#hotContent" + i).on("click", function() {
						clickHotContent(this);
					});
				}
			}
			// $("#hot_content").children().on("click",clickHotContent);
		}
	});
}
// 获取问卷详情
function clickHotContent(e) {
	var path = '/pawj/app/investigation/investigationDetailsForWeChat.do?investigationID=';
	window.location.href = path + hotContent[$(e).attr("index")].qsrId;
}
// 获取趣味报告
function getInterestContent() {
	$.ajax({
		type : 'GET',
		url : '/pawj/getHomeReport.do',
		dataType : 'JSON',
		success : function(e) {
			var data = $.parseJSON(e);
			if(data.status == '1'){
				$.popAlert("获取趣味报告出错");
			}else{
				$("#interest_content").html(data.reportContent);
				$("#interest_content").on("click", function() {
					window.location.href = '../perInfo/report.html';
				});
			}

		}
	});
}
// 提示方法
function doAlert(msg_temp) {
	$alertSpan = $('.alert_layer').find('span');
	$alertSpan.html(msg_temp);
	$alertSpan.parent().css('display', 'block');
	setTimeout("doDispear()", 3000);
}
// 取消显示提示
function doDispear() {
	$alertSpan.parent().css('display', 'none');
	$alertSpan.html('');
}
