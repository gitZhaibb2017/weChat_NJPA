	<div style="margin:20px 0;"></div>
	<div id="mainPanel">
		<div id="qsrPanel" class="easyui-panel" title="问卷基本信息" style="width:100%">
			<form id="qsrBaseForm" method="post">
				<table cellpadding="5">
		    		<tr>
		    			<td>问卷名称:</td>
		    			<td><span id="questionName">&nbsp;</span></td>
		    		</tr>
		    		<tr>
		    			<td>问卷简介:</td>
		    			<td><span id="questionSummary">&nbsp;</span></td>
		    		</tr>
		    	</table>
				<input type="hidden" name="qstId" id="qstId"></input>
			</form>
		</div>
		<div style="text-align:center;padding:5px">
	    	<a href="javascript:void(0)" class="easyui-linkbutton" onclick="addQuestion()">添加题目</a>
	    	<!-- <a href="javascript:void(0)" class="easyui-linkbutton" onclick="saveQestionnaire()">保存草稿</a> -->
	    	<a href="javascript:void(0)" class="easyui-linkbutton" onclick="saveQuestion()">保存题目</a>
	    </div>
	</div>
	<script>
		var qstNum = 0;
		var qstSeqJSON = [];
	    $('#qst_type_select').combobox({
	    	url:'/pawj/survey/publish/qstTypes.json',
	    	valueField:'id',
	    	textField:'text',
	    	onSelect: function(record){
	    		if (record.id == 'qst_typ_sel'){
			    	$('#qst1_opt1').prop("hidden", false);
	    		} else if (record.id == 'qst_typ_src'){
			    	$('#qst_asw_src').prop("hidden", false);
	    		}
	    	}
	    });
	    
	    function saveQuestion(){
	    	var questions = [];
	    	for(var i=1;i<=qstNum;i++){
				if($("#qst_seq_select_"+i)){
					var singleQuestion = {};
					singleQuestion.orderNum = $("#qst_seq_select_"+i).combobox("getValue");
					singleQuestion.qstName = $("#qst_name_"+i).val();
					singleQuestion.qstType = $("#qst_type_select_"+i).combobox("getValue");
					if(singleQuestion.qstType == 'qst_typ_mc' || singleQuestion.qstType == 'qst_typ_mcs'){
						singleQuestion.options = [];
						var optionNum = findOptNum("qst_"+i);
						for(var j=1;j<=optionNum;j++){
							if($("qst"+j+"_opt"+j)){
								singleQuestion.options.push($("qst"+j+"_opt"+j).val());
							}
						}
					}
					questions.push(singleQuestion);
				}
			}
			console.log(questions);
	    	$.ajax({
	    		async : false,
	    		cache : false,
	    		type : 'GET',
	    		dataType:'json',
	    		data : {
	    			"jsonData" : JSON.stringify(questions)
	    		},
	    		url : '/pawj/saveSubQuestion.do',// 请求的action路径
	    		error : function(XMLHttpRequest,textStatus,errorThrown) {// 请求失败处理函数
	    			alert(textStatus);
	    		},
	    		success : function(data) {
	    			alert(data);
	    		}
	    	});
	    	
	    	
	    }
	    
    	function findOptNum(qstId){
    		var optNum = 1;
    		$('#'+qstId).find("tr").each(function (i, e){
				if (e.id && e.id.indexOf(qstId + '_opt') != -1){
					optNum = optNum + 1;
				}
    		});
    		return optNum;
    	}
    	
	    function addOption(qstId){
	    	var optNum = findOptNum(qstId);
	    	var optHtml = '<tr id="'+qstId+'_opt'+optNum+'" >'+
    					  '<td>选项'+optNum+':</td> '+
						  '<td><input class="easyui-textbox" style="width:600px;" type="text" name="name" data-options="required:true"></input></td>'+
						  '<td><a href="javascript:void(0)" class="easyui-linkbutton" onclick="delOption('+qstId+'_opt'+optNum+')">DEL</a></td>'+
						  '</tr>';
			$('#'+qstId).find("table").find("#"+qstId+"_add").before(optHtml);
	    	//$('#qst1').find("table").append(optHtml);
	    	$.parser.parse('#'+qstId);
	    }
	    
	    function addQuestion(){
	    	qstNum = qstNum + 1;
	    	qstSeqJSON.push({id: qstNum, text: qstNum});
	    	var qstHtml = '<div id="qst'+qstNum+'" class="easyui-panel" title="问题'+qstNum+'" style="width:100%" data-options="tools:\'#tt'+qstNum+'\'">'+
							'<table cellpadding="5">'+
							'<tr>'+
							'<td>题目序号</td>'+
							'<td><select id="qst_seq_select_'+qstNum+'" class="easyui-combobox" style="width:600px;" data-options="valueField:\'id\', textField:\'text\'"></td>'+
						    '</tr>'+
				    		'<tr>'+
				    		'	<td>题目标题:</td>'+
				    		'	<td><input id="qst_name_'+qstNum+'" class="easyui-textbox" style="width:600px;" type="text" name="name" data-options="required:true"></input></td>'+
				    		'</tr>'+
				    		'<tr>'+
				    		'	<td>题目类型：</td>'+
				    		'	<td><select id="qst_type_select_'+qstNum+'" class="easyui-combobox" style="width:600px;" name="language" ></select></td>'+
				    		'</tr>'+
				    		'<tr id="qst_asw_sel" hidden="false">'+
				    		'	<td>问卷简介:</td> '+
				    		'	<td><input class="easyui-textbox" style="width:600px;height:60px;" name="message" data-options="multiline:true" ></input></td>'+
				    		'</tr>'+
					    	'</table>'+
							'<div id="tt'+qstNum+'">'+
							'	<a href="javascript:void(0)" class="icon-remove" onclick="delQuestion(qst'+qstNum+')"></a>'+
							'</div>'+
						   '</div>';
	    	$('#qsrPanel').append(qstHtml);
	    	$.parser.parse('#qsrPanel');
	    	
	    	function clearQst(qstType, qstId){
	    		$('#' + qstId).find("tr").each(function(i, e){
	    			if (e.id){
	    				$('#'+e.id).remove();
	    			}
	    		});
	    	}
	    	
	    	function addTrByQstType(qstType, qstId){
	    		if (qstType == 'qst_typ_mc' || qstType == 'qst_typ_mcs'){
	    			var optNum = findOptNum(qstId);
	    	    	var optHtml = '<tr id="'+qstId+'_opt'+optNum+'" >'+
					  '<td>选项'+optNum+':</td> '+
					  '<td><input class="easyui-textbox" style="width:600px;" type="text" name="name" data-options="required:true"></input></td>'+
					  '<td><a href="javascript:void(0)" class="easyui-linkbutton" onclick="delOption('+qstId+'_opt'+optNum+')">DEL</a></td>'+
					  '</tr>';
	    			$('#'+qstId).find("table").append(optHtml);
	    			
	    			if (optNum == 1){
	    				$('#'+qstId).find("table").append('<tr id="'+qstId+'_add"><td><a href="javascript:void(0)" class="easyui-linkbutton" onclick="addOption(\''+qstId+'\')">ADD</a></td></tr>');
	    			}
	    			
	    			$.parser.parse('#' + qstId);
	    		} else if (qstType == 'qst_typ_scr'){
	    			
	    		}
	    	}
		    $('#qst_type_select_'+qstNum).combobox({
		    	url:'/pawj/survey/publish/qstTypes.json',
		    	valueField:'id',
		    	textField:'text',
		    	onChange: function(record){
		    		var selectID = $(this).attr("id");
		    		var num = selectID.substr(selectID.lastIndexOf('_')+1);
		    		var qstID = 'qst' + num;
		    		clearQst(record, qstID);
		    		addTrByQstType(record, qstID);
		    	}
		    });
		    $('#language').combobox('loadData', qstSeqJSON);
		    $("select[id^='qst_seq_select_']").combobox("loadData", qstSeqJSON);
		    $('#qst_seq_select_'+qstNum).combobox('setValue', qstNum);
	    }
	    
	    function delOption(eleID){
	    	$(eleID).remove();
	    }
	    
	    function delQuestion(eleID){
	    	$(eleID).parent().remove();
	    }
	    
	    function getBaseInfo(){
	    	var baseInfo = {};
	    	baseInfo.qsrID = $('#qsrID').val();
	    	baseInfo.qsrName=$('#qsrName').val();
	    	
	    	return baseInfo;
	    }
	    
		function saveQestionnaire(){
			var questionnaire = {};
			questionnaire.baseInfo = getBaseInfo();
			var questions = [];
			$('#qsrPanel').find('div[id^=qst]').each(function(i, question){
				var qst = {};
				qst.qstSeq = $(this).find('select[id^=qst_seq_select_]').val();
				qst.qstName = $(this).find('select[id^=qst_name_]').val();
				qst.qstType = $(this).find('select[id^=qst_type_select_]').val();
				questions.push(qst);
			});
			questionnaire.questions = questions;
			alert(questionnaire);
		}
		function clearForm(){
			$('#ff').form('clear');
		}
	</script>