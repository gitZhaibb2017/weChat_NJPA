<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paic.pawj.basic.account.dao.AccountChangeInfoMapper">
	<select id="queryAccountChangesByIvtg" parameterType="String"
	        resultType="com.paic.pawj.basic.account.dao.AccountChangeInfo">
		SELECT investigation_id investigationID,answer_fee balanceChange,200 pointChange
		FROM pawj_busi_investigation p
		where investigation_id = #{ivtgID}
	</select>
	
	<insert id="insertAccountBalance" parameterType="com.paic.pawj.basic.account.dao.AccountChangeInfo">
		insert into account_balance_detail(id, account_id, user_id,sum, source,source_id,do_time,balance)
		values(uuid(),#{accountID}, #{userID},#{balanceChange},#{source},#{sourceID},#{doTime},#{balance})
	</insert>
	
	<insert id="insertAccountPoint" parameterType="com.paic.pawj.basic.account.dao.AccountChangeInfo">
		insert into account_point(id,account_id, user_id,point_change, change_time,source_id,source)
		values(uuid(),#{accountID},#{userID},#{pointChange},#{doTime},#{sourceID},#{source})
	</insert>
	
	<update id="updateAccountInfo" 
	        parameterType="com.paic.pawj.basic.account.dao.AccountChangeInfo">
		update account_account
		set balance = balance + #{balanceChange},
		    point = point + #{pointChange}
		where account_id = #{accountID}
		and user_id= #{userID}
	</update>
	
	<select id="getAccountInfo" parameterType="com.paic.pawj.basic.account.dao.AccountChangeInfo"
	        resultType="com.paic.pawj.basic.account.dao.AccountChangeInfo">
		select balance,point from account_account 
		where  account_id = #{accountID}
		and user_id= #{userID}
	</select>
</mapper>