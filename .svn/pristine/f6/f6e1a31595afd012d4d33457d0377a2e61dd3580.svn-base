var click = phoneVersion();
var distance = 30;// 刷新滑动距离

//获取请求参数

function GetQueryString(name)
{
var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
var r = window.location.search.substr(1).match(reg);
if(r!=null)return unescape(r[2]); return null;
}

//回退按钮	
$(function() {
	$("header i").click(function() {
		location.href=document.referrer;
	});
	
	// 初始化下拉列表操作
	var scrollHeight = $('body').height() - 65;
	$('#scroll_container').height(scrollHeight);
	$('#main_container').css('min-height', scrollHeight + 1);
	if(typeof IScroll != 'undefined' ){		
		new myScroll();
	}
});

function myScroll() {
	var myScroll = new IScroll('#scroll_container', {
		probeType : 3,
		mouseWheel : true,
		click : click
	});
	// 下拉刷新事件
	myScroll.on("slideDown", function() {
		if (this.y > distance) {
			// 刷新页面
			window.location.reload();
		}
	});
	return myScroll;
}

function phoneVersion() {
	var Terminal = {
		// 辨别移动终端类型
		platform : function() {
			var u = navigator.userAgent, app = navigator.appVersion;
			return {
				// android终端或者uc浏览器
				android : u.indexOf('Android') > -1 || u.indexOf('Linux') > -1,
				// 是否为iPhone或者QQHD浏览器
				iPhone : u.indexOf('iPhone') > -1,
				// 是否iPad
				iPad : u.indexOf('iPad') > -1
			};
		}(),
		// 辨别移动终端的语言：zh-cn、en-us、ko-kr、ja-jp...
		language : (navigator.browserLanguage || navigator.language)
				.toLowerCase()
	}

	if (Terminal.platform.android) {
		return true;
	} else if (Terminal.platform.iPhone) {
		return true;
	} else {
		return false;
	}
}

//定时器
;(function(){
function WJInterval(opts) {
		var intev;
		this.setting = $.extend({}, WJInterval.defaults, opts);
		this.setSelfInterval();
};
WJInterval.prototype = {
	setSelfInterval : function(){
		_this = this;
		_this.setting.onBefore();
		intev = setInterval(function(){
			_this.excuteInterval();
		}, 1000);
	},
	excuteInterval: function(){
		_this = this;
		if(_this.setting.time==0){
			clearInterval(intev);
		   _this.setting.onClear();
		}else{
			_this.setting.time--;
			_this.setting.onSet();
		}
	}
};
WJInterval.defaults = {
			time:60,//时常
			onSet:function(){},//设置定时器的业务方法
			onClear:function(){},//取消定时器后回调方法
			onBefore:function(){}//定时器执行前回调方法
}	
if ( typeof module != 'undefined' && module.exports ) {
	module.exports = WJInterval;
} else {
	window.WJInterval = WJInterval;
}
}());


//监听表单变化
;(function($){
function ChangeListen(opts) {
		this.options = $.extend({},ChangeListen.defaults,opts);
		this.getChilds();
};
ChangeListen.prototype = {
	getChilds : function(){
		var _this = this;
		var form = $(this.options.formId);
		form.find('input').each(function(index){
			$(this).bind("input propertychange",function(){
				if(_this.checkInput()){					
					_this.options.onOK();
				}else{
					_this.options.onCancel();
				}
			})
		})
	},
	//判断是否所有的input框都有输入值
	checkInput : function(){
		var form = $(this.options.formId);
		var length = form.find('input').length;
		var realLength = 0;
		form.find('input').each(function(index){
			if($(this).val().trim()!=""){
				realLength ++;
			}
		})
		if(realLength == length){
			return true;
		}
		return false;
	}
};	
ChangeListen.defaults = {
	onOK : function(){},
	onCancel : function(){},
	formId:""
}
$.fn.changeListen = function(opts){
	return new ChangeListen(opts);
}
}(Zepto));
