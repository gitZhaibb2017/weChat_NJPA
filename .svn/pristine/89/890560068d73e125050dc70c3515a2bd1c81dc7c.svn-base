$(function() {
	// 加载表格数据
	queryLottery();

	
});

// 加载数据表格
function queryLottery(){
	$('#prizeQuery').datagrid(
			{
				url : '/pawj/lotteryPrize/queryLotteryPrize.do',
				toolbar: '#toolbar',
				pagination : true,
				pageSize : 20,
				pageList : [ 10, 20, 30 ],
				fit : false,// 充满整个页面
				resizable : true,// 可调整大小
				singleSelect : true,// 只允许单选
				fitColumns : false,// 充满整个列，列比较多的话，建议false
				nowrap : false,// 当一个列中的字符比较多的时候。自动换行
				rownumbers : true,// 第一列显示行号++++++++++++		
				border : false,// 边框
				remoteSort : false,// 后台进行排序
				idField : 'fSysid',// 尽量设置唯一主键
				onLoadSuccess : function(data) {
					
				},
				onLoadError : function(data) {
					$.messager.alert('警告', '获取数据失败,请稍后再试..', 'error');
				},
				columns : [[
					
					{
						field : 'prizeName',
						title : '获奖名称',
						width : 140,
						sortable : true,
						align : 'center',
						hidden : false
					},
					{
						field : 'startTime',
						title : '开始时间',
						width : 175,
						sortable : true,
						align : 'center',
						hidden : false
					},
					{
						field : 'endTime',
						title : '结束时间',
						width : 175,
						sortable : true,
						align : 'center',
						hidden : false
					}
					,
					{
						field : 'voteNum',
						title : '奖品数量',
						width : 130,
						sortable : true,
						align : 'center',
						hidden : false
					}
					,
					{
						field : 'winnerNum',
						title : '获奖人数',
						width : 130,
						sortable : true,
						align : 'center',
						hidden : false
					}
					,
					{
						field : 'status',
						title : '状态',
						width : 130,
						sortable : true,
						align : 'center',
						hidden : false
					}
					,
					{
						field : 'level',
						title : '级别',
						width : 130,
						sortable : true,
						align : 'center',
						hidden : false
					}
					,
					{
					  field : 'opt',
					  title : '操作',
					  width : 190,
					  align : 'center',
					  formatter : function(value, row, index) {
					  var innerhtml = '';
					  innerhtml += '<a class=\"easyui-linkbutton\"  font style=\"color:blue;\" onclick=\"upd('+index+');\" plain=\"true\" href=\"javascript:void(0);\">编辑</a>';									
					  innerhtml += '&nbsp;&nbsp;';
					  innerhtml += '<a class=\"easyui-linkbutton\"  font style=\"color:blue;\" onclick=\"del('+index+');\" plain=\"true\" href=\"javascript:void(0);\">删除</a>';
					  return innerhtml;
					}}
					]],
				onRowContextMenu: function(e, rowIndex, rowData) {
					e.preventDefault();
					$(this).datagrid('unselectAll');
					$(this).datagrid('selectRow', rowIndex);
					$('#menu').menu('show', {
						left : e.pageX,
						top : e.pageY
					});
				}
				
			}
			)
	
	
}

// 添加奖项
function addPrize(){
	prizeReset();
	$('#addPrize').dialog('open');
}



// 保存奖项操作
function prizeAdd(){
	var isValid = true;
	$('#addPrize input').each(function(){
		if($(this).attr('required') || $(this).attr('validType')){
			$(this).validatebox('enableValidation');
			if (!$(this).validatebox('isValid')) {
				// 如果验证不通过，则返回false
				isValid = false;
				return;
			}
		}	
	});
	if (!isValid) {
		$.messager.alert('警告', "请输入必输字段！", 'warning');
		return;
	}
	
	$.ajax({
		async : false,
		cache : false,
		type : 'GET',
		dataType : "json",
		data: {
				"prizeId" : $("#prizeId").val(),
				"prizeName" : $("#prizeName").val(),
				"startTime" : $("#startTime").datetimebox("getValue"),
				"endTime" : $("#endTime").datetimebox("getValue"),
				"voteNum" : $("#prizeName").val(),
				"winnerNum" : $("#prizeName").val(),
				"status" : $("#status").combobox('getValue'),
				"level" : $("#level").val()
		},
		url :'/pawj/lotteryPrize/addLotteryPrize.do',
		success: function(data){
			if(data.smg == true) {
				$('#addPrize').dialog('close');
				$.messager.show({
               	 msg:'保存成功！',
		         timeout:3000,
		         showType:'slide',
                 title: '提示'
                });
				$('#prizeQuery').datagrid('reload');
			} else {
				$.messager.alert('提示', '提交失败！', 'warning');
			}
		}
	});
}

// 添加操作中的重置操作
function prizeReset() {
	$('input.easyui-validatebox').validatebox('disableValidation')
	.focus(function() {
		$(this).validatebox('enableValidation');
	}).blur(function() {
		$(this).validatebox('validate')
	});
	 $("#prizeId").val('');
	 $("#prizeName").val('');
	 $("#startTime").datetimebox("setValue","");
	 $("#endTime").datetimebox("setValue","");
     $("#voteNum").val('');
	 $("#winnerNum").val('');
	 $('#status').combobox('setValue','-1');
	 $("#level").val('');
}

// 编辑奖项
function upd(index){
	$('#updatePrize').dialog('open');
	$('#prizeQuery').datagrid('selectRow', index);
	var rowDate = $('#prizeQuery').datagrid('getSelected');
	if(rowDate != null) {
		$('#updatePrizeId').val(rowDate.prizeId);
		$('#updatePrizeName').val(rowDate.prizeName);
		$("#updateStartTime").datetimebox("setValue",rowDate.startTime);
		$("#updateEndTime").datetimebox("setValue",rowDate.endTime);
		$('#updateVoteNum').val(rowDate.voteNum);
		$('#updateWinnerNum').val(rowDate.winnerNum);
		$('#updateStatus').combobox('setValue',rowDate.status);
		$('#updateLevel').val(rowDate.level);
	}
}

// 编辑奖项中的保存操作
function updatePrizeAdd() {
	//alert('1111');
	$.ajax({
		async : false,
		cache : false,
		type : 'get',
		dataType : "json",
		data: {
				"prizeId" : $("#updatePrizeId").val(),
				"prizeName" : $("#updatePrizeName").val(),
				"startTime" : $("#updateStartTime").datetimebox("getValue"),
				"endTime" : $("#updateEndTime").datetimebox("getValue"),
				"voteNum" : $("#updateVoteNum").val(),
				"winnerNum" : $("#updateWinnerNum").val(),
				"status" : $("#updateStatus").combobox('getValue'),
				"level" : $("#updateLevel").val()
		},
		url :'/pawj/lotteryPrize/updateLotteryPrize.do',
		success: function(data){
			if(data.smg == true) {
				$('#updatePrize').dialog('close');
				$.messager.show({
               	 msg:'保存成功！',
		         timeout:3000,
		         showType:'slide',
                 title: '提示'
                });
				$('#prizeQuery').datagrid('reload');
			} else {
				$.messager.alert('提示', '提交失败！', 'warning');
			}
		}
	});
	
}

// 编辑中的关闭操作
function prizeClose(){
	$('#updatePrize').dialog('close');
	
}

// 删除
function del(index){
	//alert('1111');
	$('#prizeQuery').datagrid('selectRow', index);
	var rowDate = $('#prizeQuery').datagrid('getSelected');
	$.messager.confirm('删除提示', '你确定永久删除该数据吗?？',
			function(r) {
			if(r){
				$.ajax({
						type : "get",
						cache : false,
						async : false,
						url : "/pawj/lotteryPrize/deleteLotteryPrize.do",
						data : {
							prizeId:  rowDate.prizeId 
						},
						dataType : 'json',
						success : function(data) {
							$.messager.show({
		                	msg:'删除成功！',
				            timeout:3000,
				            showType:'slide',
		                    title: '提示'
		                 });
		                 $('#prizeQuery').datagrid('reload');
					},
					error : function(result) {
						$.messager.alert("提示", "数据提交删除失败！");
					}
				})	
			}else{
				$.messager.alert("提示", "取消删除！！");
			}
								
			});
}
