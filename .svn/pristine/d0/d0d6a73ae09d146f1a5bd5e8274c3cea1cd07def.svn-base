$(function() {
	//查询报告列表
	queryReportList();
});

//查询报告列表
function queryReportList(){
	var page = 1;
	var rows = 3;
	$.ajax({
		type : 'POST',
		url : "/pawj/report/queryReportList.do",
		data : {
			page : page ,
			reportType : page ,
			rows : rows 
		},
		dataType : "JSON",
		success : function(e) {
			e = $.parseJSON(e);
			var h = "";
			$.each(e.total,function(i,item){
				var reportId = item.reportId;
				var agreeCount = item.agreeCount;
				var againstCount = item.reportId;
				var reportName = item.reportName;//标题
				var reportContent = item.reportContent;//正文
				var changeTime = item.changeTime;
				h += '<div class="accountDiv">'
						 +'<div class="accountDiv1">'+reportName+'</div>'
						 +'<div class="accountDiv2">'+reportContent+'</div>'
						 +'<div class="accountDiv3">'
							 +'<div onclick="support(\''+reportId+'\',\'y\')"><div id="'+reportId+'_y" class="labelSupport"></div><div class="support">赞成</div></div>'
							 +'<div onclick="nonSupport(\''+reportId+'\',\'n\')"><div id="'+reportId+'_n" class="labelNonSupport"></div><div class="nonSupport">反对</div></div>'
						 +'</div>'
						 +'<div class="accountDiv4">'
							 +'<div><div></div><div id="'+reportId+'_y_num" class="supportNum noShowNum">'+agreeCount+'</div></div>'
							 +'<div><div></div><div id="'+reportId+'_n_num" class="nonSupportNum noShowNum">'+againstCount+'</div></div>'
						 +'</div>'
					 +'</div>';
			});
			$("#accountDetail").append(h);
		}
	});
}

//赞成
function support(id,flag){
	var nowClass = $('#'+id+'_'+flag+'').attr("class");
	if(nowClass == 'labelSupport'){
		$('#'+id+'_n').removeClass("labelNonSupportEd").addClass('labelNonSupport');
		$('#'+id+'_'+flag+'').removeClass("labelSupport").addClass('labelSupportEd');
		$('#'+id+'_n_num').addClass("noShowNum");
		$('#'+id+'_'+flag+'_num').removeClass("noShowNum");
	}
	voteReport(id,flag);
}

//反对
function nonSupport(id,flag){
	var nowClass = $('#'+id+'_'+flag+'').attr("class");
	if(nowClass == 'labelNonSupport'){
		$('#'+id+'_y').removeClass("labelSupportEd").addClass('labelSupport');
		$('#'+id+'_'+flag+'').removeClass("labelNonSupport").addClass('labelNonSupportEd');
		$('#'+id+'_y_num').addClass("noShowNum");
		$('#'+id+'_'+flag+'_num').removeClass("noShowNum");
	}
	voteReport(id,flag);
}

//投票
function voteReport(reportId,voteType){
	if(voteType=='y'){
		voteType = 1;
	}else{
		voteType = 0;
	}
	$.ajax({
		type : 'POST',
		url : "/pawj/report/voteReport.do",
		data : {
			reportId : reportId ,
			voteType : voteType 
		},
		dataType : "JSON",
		success : function(e) {
			e = $.parseJSON(e);
			$('#'+reportId+'_y_num').text(e.obj.agreeCount);
			$('#'+reportId+'_n_num').text(e.obj.againstCount);
		}
	});
}
