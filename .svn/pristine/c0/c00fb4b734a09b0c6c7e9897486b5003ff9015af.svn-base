$(function() {
	//获取手机号码 
	var hidetel = $('#unbindMobile').html(sessionStorage.getItem('hidetel'));
	
	/**
	 * 获取验证码-点击按钮
	 */
	 var t;
	 var wait;
	$("#getMobileCode").click(function() {
		$(this).attr("disabled", "disabled");
		wait = 120; 
		$(this).val(wait + "秒后重新获取");
		t = setInterval(function() {
			setTime()
		}, 1000);

	});

	function setTime() {
		wait--;
		if (wait == 0) {
			clearInterval(t);
			$("#getMobileCode").val("获取验证码");
		} else {
			$("#getMobileCode").val(wait + "秒后重新获取");
		}
	}

	/**
	 * 获取验证码-发送至手机
	 */
	$("#getMobileCode").click(function() {
		var mobile = sessionStorage.getItem('mobile');
		if (Validator.validateNull(hidetel)) {
			$.popAlert("无法获取到手机号");
			return false;
	   }
		$.ajax({
			type : 'POST',
			url : '/pawj/auth/getCheckCode.do',
			dataType : "JSON",
			data : {
				"mobile" : mobile
			},
			success : function(e) {
				var data = $.parseJSON(e);
				if (data.infoMsg == 1) {
				 $.popAlert("验证码发送失败!");	
				}
			}
		});

	});

	/**
	 * 提交验证码
	 */
	$('#bindMobileSubBtn').click(function() {
		var authCode = $("#bindMobileCode").val().trim();
		var mobile = sessionStorage.getItem('mobile');
		
	   // 校验验证码
	   if(!Validator.validateCode(authCode)) {
			$.popAlert("请输入6位数字验证码！");
			return false;
	     }
		
		$.ajax({
			type : 'POST',
			url : "/pawj/app/person/updateMobile.do",
			dataType : "JSON",
			data : {
				"checkCode" : authCode,
				"mobile"    : mobile
			},
			success : function(data) {
				var e = $.parseJSON(data);
				if (e.msg == 1) {
				   window.location.href="bindMobile.html";
		      }else{
		    	  $.popAlert("验证码有误!");
		      }
			}
		});
	});
	
	//监听表单变化
	$("#unbindMobileSec").changeListen({
		formId : "#unbindMobileSec",
		onOK : function() {
			$("#bindMobileSubBtn").css({
				background : "#ffb71d"
			}).removeAttr("disabled");
		},
		onCancel : function() {
			$("#bindMobileSubBtn").css({
				background : "#ccc"
			}).attr("disabled","disabled");
		}
	});
});





   
		

